<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>INTUITY — English Grammar Quiz</title>
<style>
:root{
  --bg:#060606;
  --muted:#dfeee0;
  --lime:#9be56a;
  --orange:#ffa24b;
  --softblue:#5aa1f2;
  --card-pad:16px;
  --accent-bezier:cubic-bezier(.4,0,.2,1);
  font-family: -apple-system, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
}
*{box-sizing:border-box;}
body{margin:0;height:100%;background:linear-gradient(180deg,#050606,#071113);color:var(--muted);-webkit-font-smoothing:antialiased;}
.container{max-width:500px;margin:20px auto;padding:16px;display:flex;flex-direction:column;gap:16px;}
.header{text-align:center;margin-bottom:10px;}
.header h1{margin:0;font-size:22px;color:whitesmoke;font-weight:600;}
.header .sub{font-size:13px;color:rgba(255,255,255,0.7);}
.header .author{font-size:12px;color:rgba(255,255,255,0.45);}
.boardWrap{background:rgba(255,255,255,0.02);border-radius:16px;padding:16px;display:flex;flex-direction:column;gap:12px;position:relative;}
.topBar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.players{display:flex;gap:10px;}
.player{padding:6px 10px;border-radius:12px;background:rgba(255,255,255,0.03);display:flex;align-items:center;gap:6px;font-size:14px;}
.toggleWrap{display:flex;align-items:center;gap:6px;}
.toggleLabel{font-size:12px;}
.toggleSwitch{position:relative;display:inline-block;width:50px;height:24px;}
.toggleSwitch input{opacity:0;width:0;height:0;}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#333;border-radius:34px;transition:.4s;}
.slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background:white;border-radius:50%;transition:.4s;}
input:checked + .slider{background:var(--softblue);}
input:checked + .slider:before{transform:translateX(26px);}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.cell{aspect-ratio:1/1;border-radius:14px;background:rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--softblue);cursor:pointer;transition:transform .25s,box-shadow .18s;position:relative;padding:8px;text-align:center;font-weight:600;}
.cell:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.6);}
.cell.claimed-X{background:var(--orange);color:#000;}
.cell.claimed-O{background:var(--lime);color:#000;}
.cell.active{box-shadow:0 0 12px rgba(255,255,255,0.12);}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:50;}
.modal.show{display:flex;}
.panel{background:rgba(255,255,255,0.05);border-radius:14px;padding:16px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;display:flex;flex-direction:column;gap:12px;}
.q{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);}
.q h4{margin:0 0 6px 0;font-size:14px;}
.choices{display:flex;flex-wrap:wrap;gap:8px;}
.choice{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);cursor:pointer;background:transparent;transition:all 0.2s;}
.choice:hover{background:rgba(255,255,255,0.05);}
.choice.selected{outline:2px solid var(--softblue);background:rgba(90,161,242,0.15);}
.choice.correct{background:var(--lime);color:#000;}
.choice.wrong{background:var(--orange);color:#000;}
input.choice{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);width:100%;background:#111;color:#fff;}
input.choice:focus{outline:2px solid var(--softblue);}
input.choice.correct{background:#1a5c2e;color:var(--lime);}
input.choice.wrong{background:#5c1a1a;color:var(--orange);}
.panelFooter{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.05);}
.btn{padding:8px 14px;border-radius:10px;border:none;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s;}
.btn.primary{background:var(--softblue);color:#000;}
.btn.primary:hover{background:#6bb5ff;transform:translateY(-1px);}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--muted);}
.btn.ghost:hover{background:rgba(255,255,255,0.08);}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>INTUITY</h1>
    <div class="sub">Intuitive & Immersive</div>
    <div class="author">Majid Nashtai</div>
  </div>

  <div class="boardWrap">
    <div class="topBar">
      <div class="players">
        <div class="player" id="playerX">❌ <span id="scoreX">0</span></div>
        <div class="player" id="playerO">⭕ <span id="scoreO">0</span></div>
      </div>
      <div class="toggleWrap">
        <span class="toggleLabel">A2</span>
        <label class="toggleSwitch">
          <input type="checkbox" id="modeToggle">
          <span class="slider"></span>
        </label>
        <span class="toggleLabel">B2/C1</span>
      </div>
    </div>

    <div class="grid" id="grid"></div>
  </div>
</div>

<div class="modal" id="modal">
  <div class="panel">
    <div id="panelBody"></div>
    <div class="panelFooter">
      <button class="btn ghost" id="closeBtn">Close</button>
      <button class="btn primary" id="submitBtn">Submit</button>
    </div>
  </div>
</div>

<script>
let allTopicData = {};
let currentMode = 'A2';
let boardState = Array(9).fill(null);
let currentTurn = 'X';
let activeIndex = null;
let currentQuestions = [];

const TOPICS_A2 = [
  ['SimplePresent','PresentContinuous','FrequencyAdverbs'],
  ['BasicCollocations','PersonalRoutine','NegativeStatements'],
  ['BasicQuestions','SimplePastRoutine','BasicAdverbsOfManner']
];

const TOPICS_B2C1 = [
  ['Cities','English','Sports'],
  ['English','Music','English'],
  ['FamousPeople','Countries','English']
];

const TOPIC_FILES = {
  'Cities': 'cities.json',
  'Countries': 'countries.json',
  'Sports': 'sports.json',
  'Music': 'music.json',
  'FamousPeople': 'famous-people.json',
  'English': 'advanced-mode.json'
};

function getTopics() {
  return currentMode === 'A2' ? TOPICS_A2 : TOPICS_B2C1;
}

function shuffleArray(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

async function loadMode(mode) {
  try {
    if(mode === 'A2') {
      const res = await fetch('elementary-mode.json');
      allTopicData = await res.json();
    } else {
      // Load all topic files
      for(const [topicName, fileName] of Object.entries(TOPIC_FILES)) {
        if(fileName === 'advanced-mode.json') continue;
        const res = await fetch(fileName);
        const data = await res.json();
        allTopicData[topicName] = data;
      }
      const advRes = await fetch('advanced-mode.json');
      allTopicData['English'] = await advRes.json();
    }
    buildGrid();
  } catch (error) {
    console.error('Error loading data:', error);
  }
}

function buildGrid(){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  const topics = getTopics();
  
  for(let r=0;r<3;r++){
    for(let c=0;c<3;c++){
      const idx = r*3+c;
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.index = idx;
      cell.textContent = topics[r][c];
      cell.addEventListener('click',()=>openModal(idx));
      grid.appendChild(cell);
    }
  }
}

loadMode(currentMode);

document.getElementById('modeToggle').addEventListener('change',(e)=>{
  currentMode = e.target.checked ? 'B2/C1' : 'A2';
  resetBoard();
  loadMode(currentMode);
});

const modal = document.getElementById('modal');
const panelBody = document.getElementById('panelBody');
const closeBtn = document.getElementById('closeBtn');
const submitBtn = document.getElementById('submitBtn');

function openModal(idx){
  if(boardState[idx]) return;
  activeIndex = idx;
  modal.classList.add('show');
  const topics = getTopics();
  const topic = topics[Math.floor(idx/3)][idx%3];
  renderQuestions(topic);
  document.querySelector(`.cell[data-index='${idx}']`).classList.add('active');
}

function closeModal(){
  modal.classList.remove('show');
  if(activeIndex!==null){
    document.querySelector(`.cell[data-index='${activeIndex}']`).classList.remove('active');
    activeIndex = null;
  }
}

closeBtn.addEventListener('click',closeModal);

function renderQuestions(topic){
  panelBody.innerHTML='';
  
  let questions = [];
  if(currentMode === 'A2') {
    questions = allTopicData[topic] ? allTopicData[topic].slice(0, 5) : [];
  } else {
    const topicData = allTopicData[topic];
    if(topicData && topicData.questions) {
      questions = shuffleArray([...topicData.questions]).slice(0, 5);
    }
  }
  
  currentQuestions = questions;
  
  questions.forEach((q,i)=>{
    const qdiv = document.createElement('div'); 
    qdiv.className='q';
    qdiv.dataset.qIndex = i;
    
    const h = document.createElement('h4'); 
    h.textContent = `Q${i+1}. ${q.q}`; 
    qdiv.appendChild(h);

    if(q.type==='mcq'){
      const ch = document.createElement('div'); 
      ch.className='choices';
      q.opts.forEach((opt,oi)=>{
        const btn = document.createElement('button'); 
        btn.className='choice'; 
        btn.textContent=opt;
        btn.dataset.optIndex = oi;
        btn.addEventListener('click',()=>btn.classList.toggle('selected'));
        ch.appendChild(btn);
      });
      qdiv.appendChild(ch);
    } else if(q.type==='gap'){
      const inp = document.createElement('input'); 
      inp.className='choice'; 
      inp.placeholder='type answer';
      inp.dataset.qIndex = i;
      qdiv.appendChild(inp);
    }
    panelBody.appendChild(qdiv);
  });
}

submitBtn.addEventListener('click',()=>{
  if(activeIndex===null) return;
  let allCorrect = true;
  const qDivs = Array.from(panelBody.querySelectorAll('.q'));

  currentQuestions.forEach((q,i)=>{
    const qdiv = qDivs[i];
    if(q.type==='mcq'){
      const selected = Array.from(qdiv.querySelectorAll('.choice.selected'));
      const correctIndex = q.ans;
      const correctOption = q.opts[correctIndex];
      
      if(selected.length===1 && selected[0].textContent===correctOption){
        selected[0].classList.add('correct');
      } else { 
        allCorrect=false; 
        selected.forEach(s=>s.classList.add('wrong'));
        qdiv.querySelectorAll('.choice').forEach((btn,idx)=>{
          if(idx===correctIndex) btn.classList.add('correct');
        });
      }
    } else if(q.type==='gap'){
      const inp = qdiv.querySelector('input');
      const val = inp.value.trim().toLowerCase();
      if(val===q.ans.toLowerCase()){ 
        inp.classList.add('correct'); 
      } else { 
        allCorrect=false; 
        inp.classList.add('wrong');
      }
    }
  });

  if(allCorrect){ 
    const cell = document.querySelector(`.cell[data-index='${activeIndex}']`);
    boardState[activeIndex]=currentTurn;
    cell.classList.add(currentTurn==='X'?'claimed-X':'claimed-O');
    document.getElementById(currentTurn==='X'?'scoreX':'scoreO').textContent = parseInt(document.getElementById(currentTurn==='X'?'scoreX':'scoreO').textContent)+1;
    currentTurn = currentTurn==='X'?'O':'X';
  }
});

function resetBoard(){
  boardState.fill(null);
  currentTurn='X';
  document.getElementById('scoreX').textContent=0;
  document.getElementById('scoreO').textContent=0;
  buildGrid();
}
</script>
</body>
</html>
