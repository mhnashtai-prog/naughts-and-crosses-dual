<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>INTUITY — Naughts & Crosses</title>
<style>
:root{
  --bg:#060606; --muted:#dfeee0; --lime:#9be56a; --orange:#ff9f45;
  --card-pad:18px; --accent-bezier:cubic-bezier(.4,0,.2,1);
  font-family: -apple-system, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#050606 0%, #071113 100%);color:var(--muted);-webkit-font-smoothing:antialiased}
.container{max-width:980px;margin:22px auto;padding:18px;display:flex;flex-direction:column;gap:18px}
.header{text-align:center}
.header h1{margin:0;font-size:24px;font-weight:600;color:whitesmoke}
.header .sub{font-size:14px;color:rgba(255,255,255,0.7)}
.header .author{font-size:12px;color:rgba(255,255,255,0.45)}
.statusBar{display:flex;justify-content:center;gap:20px;margin:12px 0}
.player{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03)}
.player .icon{font-size:18px}
.gridWrap{display:flex;justify-content:center;margin-top:12px}
.grid{display:grid;grid-template-columns:repeat(3,120px);grid-template-rows:repeat(3,120px);gap:12px}
.cell{display:flex;align-items:center;justify-content:center;border-radius:14px;cursor:pointer;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.3));border:1px solid rgba(255,255,255,0.03);font-weight:600;font-size:14px;text-align:center;transition:all .3s}
.cell.claimed-X{background:var(--orange);color:#050505;}
.cell.claimed-O{background:var(--lime);color:#050505;}
.cell:hover{transform:translateY(-4px)}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px;background:rgba(0,0,0,0.7);z-index:50}
.modal.show{display:flex}
.panel{width:720px;max-width:95vw;border-radius:14px;padding:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.5));border:1px solid rgba(255,255,255,0.04);backdrop-filter:blur(6px);overflow:hidden}
.panelHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.panelBody{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.q{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(0,0,0,0.25));padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
.q input{width:100%;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.02);color:#fff}
.choices{display:flex;flex-wrap:wrap;gap:8px}
.choice{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);cursor:pointer;background:transparent;color:#fff;transition:all .2s}
.choice.selected{outline:2px solid rgba(255,255,255,0.2)}
.choice.correct{background:var(--lime);color:#050505;}
.choice.wrong{background:rgba(255,80,80,0.12);border-color:rgba(255,80,80,0.18);}
.panelFooter{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.btn{padding:6px 12px;border-radius:10px;border:0;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
.btn.primary{background:linear-gradient(180deg,var(--lime),#5dd26b);color:#050505}
.toggleWrap{display:flex;align-items:center;gap:8px;font-size:13px}
.toggleWrap label{cursor:pointer}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>INTUITY</h1>
    <div class="sub">Intuitive & Immersive</div>
    <div class="author">Majid Nashtai</div>
  </div>

  <div class="statusBar">
    <div class="player" id="playerX"><div class="icon">❌</div><div class="meta">Player X — <strong id="scoreX">0</strong></div></div>
    <div class="player" id="playerO"><div class="icon">⭕</div><div class="meta">Player O — <strong id="scoreO">0</strong></div></div>
    <div class="toggleWrap">
      <span>B2/C1</span>
      <label>
        <input type="checkbox" id="modeToggle" />
        <span>A2</span>
      </label>
    </div>
  </div>

  <div class="gridWrap">
    <div class="grid" id="grid"></div>
  </div>
</div>

<!-- modal -->
<div class="modal" id="modal">
  <div class="panel">
    <div class="panelHeader">
      <h4>Questions</h4>
      <button class="btn ghost" id="closeBtn">Close</button>
    </div>
    <div class="panelBody" id="panelBody"></div>
    <div class="panelFooter">
      <button class="btn primary" id="submitBtn">Submit</button>
    </div>
  </div>
</div>

<script>
let currentMode='advanced';
let currentData={};
let boardState=Array(9).fill(null);
let activeIndex=null;
let playerTurn='X';
let usedSquares=new Set();

// load JSON
async function loadData(mode){
  const resp = await fetch(mode==='advanced'?'advanced-mode.json':'elementary-mode.json');
  currentData = await resp.json();
  renderGrid();
}
function renderGrid(){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  const topics=Object.keys(currentData).slice(0,9);
  topics.forEach((t,i)=>{
    const cell=document.createElement('div');
    cell.className='cell';
    cell.dataset.index=i;
    cell.dataset.topic=t;
    cell.textContent=t;
    cell.addEventListener('click',()=>openModal(i,t));
    grid.appendChild(cell);
  });
}

// modal
const modal=document.getElementById('modal');
const panelBody=document.getElementById('panelBody');
document.getElementById('closeBtn').addEventListener('click',()=>{
  modal.classList.remove('show'); activeIndex=null;
});

function openModal(idx,topic){
  if(boardState[idx] || usedSquares.has(idx)) return;
  activeIndex=idx;
  renderQuestions(topic, idx);
  modal.classList.add('show');
}

function renderQuestions(topic, idx){
  panelBody.innerHTML='';
  const qset=currentData[topic]||[];
  let available=qset.filter(q=>!q.used);
  if(available.length===0) available=qset;
  const q=available[Math.floor(Math.random()*available.length)];
  q.used=true;

  const qdiv=document.createElement('div'); qdiv.className='q';
  const h=document.createElement('h4'); h.textContent=q.q;
  qdiv.appendChild(h);

  if(q.type==='mcq'){
    const ch=document.createElement('div'); ch.className='choices';
    const shuffled=q.opts.sort(()=>Math.random()-0.5);
    shuffled.forEach(opt=>{
      const b=document.createElement('button'); b.className='choice'; b.textContent=opt;
      b.addEventListener('click',()=>{Array.from(ch.children).forEach(c=>c.classList.remove('selected')); b.classList.add('selected');});
      ch.appendChild(b);
    });
    qdiv.appendChild(ch);
  } else if(q.type==='gap'){
    const inp=document.createElement('input'); inp.placeholder='type answer';
    qdiv.appendChild(inp);
  }

  panelBody.appendChild(qdiv);
}

document.getElementById('submitBtn').addEventListener('click',()=>{
  if(activeIndex===null) return;
  const cell=document.querySelector(`.cell[data-index='${activeIndex}']`);
  boardState[activeIndex]=playerTurn;
  usedSquares.add(activeIndex);
  cell.classList.add(playerTurn==='X'?'claimed-X':'claimed-O');
  playerTurn=playerTurn==='X'?'O':'X';
  updateScores();
  modal.classList.remove('show'); activeIndex=null;
});

function updateScores(){
  const scoreX=boardState.filter(v=>'X'===v).length;
  const scoreO=boardState.filter(v=>'O'===v).length;
  document.getElementById('scoreX').textContent=scoreX;
  document.getElementById('scoreO').textContent=scoreO;
}

// mode toggle
document.getElementById('modeToggle').addEventListener('change',e=>{
  currentMode=e.target.checked?'elementary':'advanced';
  loadData(currentMode);
});

loadData(currentMode);
</script>
</body>
</html>
