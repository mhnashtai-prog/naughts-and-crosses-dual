<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTUITY — Naughts & Crosses</title>
<style>
body {
  margin:0; font-family: -apple-system, 'SF Pro Text', Helvetica, Arial, sans-serif; 
  background: #060606; color: #dfeee0; display:flex; flex-direction:column; align-items:center; padding:20px;
}
.header {text-align:center; margin-bottom:20px;}
.header h1{margin:0;font-size:28px;color:#fff;}
.header .sub{font-size:14px;color:#aaa;}
#modeToggle {margin-top:10px; padding:4px 6px; border-radius:6px; border:none;}
.board {display:grid; grid-template-columns:repeat(3,150px); grid-gap:12px;}
.cell {
  height:150px; display:flex; align-items:center; justify-content:center; 
  background: rgba(255,255,255,0.05); border-radius:12px; color:#fff; font-weight:600; 
  cursor:pointer; transition:0.2s; text-align:center; padding:6px; font-size:16px;
}
.cell:hover {background: rgba(155,229,106,0.15);}
.modal {display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center;}
.panel {background:rgba(255,255,255,0.05); padding:20px; border-radius:12px; width:90%; max-width:500px; max-height:80%; overflow-y:auto;}
.question {margin-bottom:12px;}
.question h4 {margin:0 0 4px 0; font-size:14px;}
.choice {display:block; margin:3px 0; padding:6px 8px; border-radius:6px; cursor:pointer; background:rgba(255,255,255,0.05);}
.choice:hover {background:rgba(155,229,106,0.15);}
.correct {background:lime;color:#000;}
.wrong {background:orange;color:#000;}
input.answer {width:100%; padding:6px; border-radius:6px; border:none; margin-top:4px; background: rgba(255,255,255,0.05); color:#fff;}
input.answer:focus {outline:2px solid #9be56a; background: rgba(155,229,106,0.05);}
</style>
</head>
<body>

<div class="header">
  <h1>INTUITY</h1>
  <div class="sub">Intuitive & Immersive — Majid Nashtai</div>
  <select id="modeToggle">
    <option value="advance">B2/C1 Mode</option>
    <option value="elementary">A2 Mode</option>
  </select>
</div>

<div class="board" id="board"></div>

<div class="modal" id="modal">
  <div class="panel" id="modalContent"></div>
</div>

<script>
let questionsData = {};
let mode = 'advance';
let boardState = Array(9).fill(null); // store owner X/O

async function loadJSON(){
  const fileName = mode === 'advance' ? 'advance-mode.json' : 'elementary-mode.json';
  try{
    const res = await fetch(fileName);
    questionsData = await res.json();
    renderGrid();
  } catch(e){
    console.error('Error loading JSON:', e);
    questionsData = {};
  }
}

function renderGrid(){
  const board = document.getElementById('board');
  board.innerHTML='';
  const topics = questionsData.topics || Array(9).fill('').map((_,i)=>`Square${i+1}`);
  topics.forEach((topic,i)=>{
    const cell=document.createElement('div');
    cell.className='cell';

    if(boardState[i]){
      cell.textContent=boardState[i].owner;
      cell.style.color = boardState[i].owner==='X' ? 'lime' : 'orange';
      cell.style.fontSize='48px';
      cell.style.fontWeight='bold';
      cell.style.background='rgba(255,255,255,0.1)';
    } else {
      cell.textContent=topic;
    }

    cell.addEventListener('click',()=>{
      if(!boardState[i]){
        cell.style.background='rgba(139,69,19,0.2)'; // light brick while attempting
        openModal(i,topic);
      }
    });

    board.appendChild(cell);
  });
}

function openModal(index, topic){
  const modal = document.getElementById('modal');
  const panel = document.getElementById('modalContent');
  panel.innerHTML = `<h3>${topic}</h3>`;
  
  if(questionsData[topic]){
    questionsData[topic].forEach((q,i)=>{
      const div = document.createElement('div');
      div.className='question';
      div.innerHTML = `<h4>Q${i+1}: ${q.q}</h4>`;
      if(q.type==='mcq'){
        q.opts.forEach((opt,oi)=>{
          const btn = document.createElement('div');
          btn.className='choice';
          btn.textContent=opt;
          btn.addEventListener('click',()=>{
            if(Number(oi)===q.a){
              btn.classList.add('correct');
              claimSquare(index,'X'); // current player X
            } else {
              btn.classList.add('wrong');
            }
          });
          div.appendChild(btn);
        });
      } else if(q.type==='gap'){
        const inp = document.createElement('input');
        inp.className='answer';
        inp.placeholder='Type answer';
        inp.addEventListener('change',()=>{
          if(inp.value.trim().toLowerCase()===String(q.a).toLowerCase()){
            inp.classList.add('correct');
            claimSquare(index,'X');
          } else {
            inp.classList.add('wrong');
          }
        });
        div.appendChild(inp);
      }
      panel.appendChild(div);
    });
  } else {
    panel.innerHTML += '<p>No questions loaded</p>';
  }

  modal.style.display='flex';
}

function claimSquare(index,player){
  if(!boardState[index]){
    boardState[index]={owner:player};
    renderGrid();
  }
}

document.getElementById('modeToggle').addEventListener('change',(e)=>{
  mode=e.target.value;
  boardState=Array(9).fill(null); // reset board
  loadJSON();
});

document.getElementById('modal').addEventListener('click',()=>{ 
  document.getElementById('modal').style.display='none';
});

window.onload = loadJSON;
</script>

</body>
</html>
